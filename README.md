# 幂等

幂等，有些地方也称为防重，一般在以下场景中会遇到：
1. 前端重复提交
2. 接口的攻击或测试（和1类似）
3. 接口超时重试
4. 消息队列消息的重复消费

对于不同的场景，实现幂等的方式也可以不同。<br/>
对于像查询这样没有副作用的操作，一般不用进行幂等处理。<br/>
对于页面的重复提交，前端页面可以跳转、按钮置灰的方式在重复发生前阻止重复。<br/>
当然，前端实现的这些功能，一般可以被绕过直接请求接口，所以后端在需要的地方必定要实现幂等。后端实现幂等，按照需求及成本的不同，也有不同的方式。

幂等防重，首先需要定义的是什么是重复，唯一性从何而来。<br/>
为了让我们的唯一性能更通用一些，我们可以：
1. 服务端（生产者）在“事务”开始前，生成token，客户端（消费者）加载时加载token，“事务”请求时带上token，这种情况客户端可以按照自己的逻辑安排什么时候请求token
2. 客户端自行生成id，请求时带上id，这种与1也差不多，只是对于服务端来说，因为客户端有可能是不同类型的，而不同客户端的请求id可能会冲突，因此可以通过consumerId与requestId来唯一标识

在有了唯一性后，接下来的实现方式也有不同成本和要求：
1. 要求较高，客户端无感，即客户端不需要对服务端的响应做一些处理，这部分实现，可以参考本项目代码<br/>
实现要点：<br/>
1、每一请求的响应，都应落库，以此来使得对于相同的请求，总是能返回相同的结果；<br/>
2、并发的情况，对于相同的两个请求，因事务并发隔离的原因而可能会造成冲突，这时可以直接失败其中一个，并直接丢弃响应；<br/>
或者与客户端约定【处理中】的一种响应，客户端接收到这种响应直接丢弃
2. 其它
